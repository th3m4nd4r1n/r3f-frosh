<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Maps Directions - Enter Addresses or Click on Map</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC9_x_mhwhDwiGKCIwONa3CHz_618xZct0&libraries=places&callback=initMap" async defer></script>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: 'Roboto', sans-serif;
        }
        #map {
            height: 100%;
            width: 100%;
        }
        #menu-button {
            background-color: transparent;
            border: none;
            cursor: pointer;
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 10;
            transition: transform 0.3s;
        }
        #menu-button svg {
            width: 40px;
            height: 40px;
            fill: #007bff;
            stroke: #0056b3;
            stroke-width: 1;
        }
        #menu-button:hover svg {
            fill: #0056b3;
            stroke: #003f7f;
        }
        #menu-container {
            position: absolute;
            top: 50px;
            left: 10px;
            z-index: 5;
            transition: transform 0.3s ease-in-out;
            transform: translateX(-350px);
        }
        #menu-container.open {
            transform: translateX(0);
        }
        #directions-form {
            background-color: #333;
            color: #fff;
            padding: 15px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            width: 260px;
            margin-bottom: 5px;
        }
        #directions-form label {
            font-weight: bold;
            margin-bottom: 5px;
        }
        #directions-form select, #directions-form button {
            margin-bottom: 15px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            width: 260px;
        }
        #directions-form input {
            margin-bottom: 15px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            width: 240px;
        }
        #directions-form input, #directions-form select {
            background-color: #555;
            color: #fff;
            border: none;
        }
        #directions-form button {
            background-color: #007bff;
            color: #fff;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #directions-form button:hover {
            background-color: #0056b3;
        }
        #route-details {
            display: none;
            background-color: #333;
            color: #fff;
            border: 1px solid #ccc;
            margin-top: 10px;
            padding: 10px;
            max-height: 120px; /* Reduced by 30px */
            overflow-y: auto;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            border-radius: 8px;
            transition: max-height 0.3s ease-out;
            width: 270px; /* Increased by 5px */
            font-family: 'Roboto Mono', monospace;
        }
        #route-details div {
            margin-bottom: 5px;
            font-size: 14px;
            display: flex;
            align-items: center;
        }
        #route-details .step {
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
            margin-bottom: 5px;
        }
        #route-details .step:last-child {
            border-bottom: none;
        }
        #route-details .instructions {
            font-size: 12px;
            margin-top: 2px;
            margin-left: 30px;
        }
        #route-details .icon {
            width: 24px;
            height: 24px;
            margin-right: 10px;
            filter: invert(1); /* Make icons white */
        }
        #route-details::-webkit-scrollbar {
            width: 10px;
        }
        #route-details::-webkit-scrollbar-thumb {
            background-color: #007bff;
            border-radius: 10px;
        }
        #route-details::-webkit-scrollbar-track {
            background-color: #f1f1f1;
            border-radius: 10px;
        }
        #reset-button {
            background-color: #007bff;
            border: none;
            border-radius: 50%;
            color: #fff;
            cursor: pointer;
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }
        #reset-button:hover {
            background-color: #0056b3;
        }
        #reset-button svg {
            width: 24px;
            height: 24px;
        }

        @media (max-width: 600px) {
            #menu-button {
                top: 5px;
                left: 5px;
                width: 30px;
                height: 30px;
            }
            #menu-button svg {
                width: 30px;
                height: 30px;
            }
            #menu-container {
                top: 40px;
                left: 5px;
                transform: translateX(-280px);
            }
            #directions-form {
                width: 220px;
                padding: 10px;
            }
            #directions-form input, #directions-form select, #directions-form button {
                width: 200px;
                padding: 8px;
                font-size: 12px;
            }
            #route-details {
                width: 220px;
                padding: 8px;
            }
        }
    </style>
    <script>
        var map;
        var directionsService;
        var directionsDisplay;
        var originMarker;
        var destinationMarker;
        var speechSynthesisUtterance;

        function initMap() {
            var center = {lat: 30.35449823789197, lng: 76.36543075700676};
            var zoom = 17;

            map = new google.maps.Map(document.getElementById('map'), {
                zoom: zoom,
                center: center,
                minZoom: 17,
                maxZoom: 20,
                gestureHandling: 'greedy',
                mapTypeControl: false
            });

            directionsService = new google.maps.DirectionsService();
            directionsDisplay = new google.maps.DirectionsRenderer({
                suppressMarkers: true
            });
            directionsDisplay.setMap(map);

            map.addListener('click', function(event) {
                placeMarker(event.latLng);
            });

            document.getElementById('travel-mode').addEventListener('change', calculateAndDisplayRoute);
        }

        function placeMarker(latLng) {
            var geocoder = new google.maps.Geocoder();
            geocoder.geocode({'location': latLng}, function(results, status) {
                if (status === 'OK') {
                    if (results[0]) {
                        var address = results[0].formatted_address;
                        setMarker(latLng, address, !originMarker);
                    } else {
                        window.alert('No results found');
                    }
                } else {
                    window.alert('Geocoder failed due to: ' + status);
                }
            });
        }

        function setMarker(latLng, title, isOrigin) {
            var markerOptions = {
                position: latLng,
                map: map,
                title: title,
                draggable: true,
                animation: google.maps.Animation.DROP,
                icon: {
                    url: 'http://maps.google.com/mapfiles/ms/icons/red-dot.png'
                }
            };

            if (isOrigin) {
                if (originMarker) {
                    originMarker.setMap(null);
                }
                originMarker = new google.maps.Marker(markerOptions);
                originMarker.addListener('dragend', function() {
                    updateAddress(originMarker, 'origin');
                    if (destinationMarker) {
                        calculateAndDisplayRoute();
                    }
                });
                document.getElementById('origin').value = title;
            } else {
                if (destinationMarker) {
                    destinationMarker.setMap(null);
                }
                destinationMarker = new google.maps.Marker(markerOptions);
                destinationMarker.addListener('dragend', function() {
                    updateAddress(destinationMarker, 'destination');
                    if (originMarker) {
                        calculateAndDisplayRoute();
                    }
                });
                document.getElementById('destination').value = title;
                calculateAndDisplayRoute();
            }
        }

        function updateAddress(marker, elementId) {
            var geocoder = new google.maps.Geocoder();
            geocoder.geocode({'location': marker.getPosition()}, function(results, status) {
                if (status === 'OK') {
                    if (results[0]) {
                        document.getElementById(elementId).value = results[0].formatted_address;
                    }
                }
            });
        }

        function calculateAndDisplayRoute() {
            var origin, destination;

            if (originMarker && destinationMarker) {
                origin = originMarker.getPosition();
                destination = destinationMarker.getPosition();
            } else {
                origin = document.getElementById('origin').value;
                destination = document.getElementById('destination').value;
            }

            var travelMode = document.getElementById('travel-mode').value;

            var request = {
                origin: origin,
                destination: destination,
                travelMode: google.maps.TravelMode[travelMode]
            };

            directionsService.route(request, function(result, status) {
                if (status == 'OK') {
                    directionsDisplay.setDirections(result);
                    speakDirections(result);
                    displayRouteSteps(result);

                    const menuContainer = document.getElementById('menu-container');
                    if (!menuContainer.classList.contains('open')) {
                        toggleMenu();
                    }
                } else {
                    window.alert('Directions request failed due to ' + status);
                }
            });
        }

        function displayRouteSteps(result) {
            var steps = result.routes[0].legs[0].steps;
            var routeDetails = document.getElementById('route-details');
            routeDetails.innerHTML = `
                <div><strong>Distance:</strong> ${result.routes[0].legs[0].distance.text}</div>
                <div><strong>Duration:</strong> ${result.routes[0].legs[0].duration.text}</div>
            `;
            routeDetails.style.display = 'block';

            for (var i = 0; i < steps.length; i++) {
                var step = steps[i];
                var div = document.createElement('div');
                div.className = 'step';

                var iconUrl = getIconUrl(step.travel_mode);

                div.innerHTML = `
                    <div class="instructions">
                        <img src="${iconUrl}" class="icon" alt="${step.travel_mode}">
                        ${step.instructions}
                    </div>
                `;

                routeDetails.appendChild(div);
            }
        }

        function getIconUrl(travelMode) {
            switch (travelMode) {
                case 'DRIVING':
                    return 'https://img.icons8.com/ios-filled/50/ffffff/car.png';
                case 'WALKING':
                    return 'https://img.icons8.com/ios-filled/50/ffffff/walking.png';
                case 'BICYCLING':
                    return 'https://img.icons8.com/ios-filled/50/ffffff/bicycle.png';
                case 'TRANSIT':
                    return 'https://img.icons8.com/ios-filled/50/ffffff/bus.png';
                default:
                    return 'https://maps.google.com/mapfiles/ms/icons/red-dot.png';
            }
        }

        function speakDirections(result) {
            var steps = result.routes[0].legs[0].steps;
            var speech = '';
            for (var i = 0; i < steps.length; i++) {
                speech += steps[i].instructions + '. ';
            }
            speechSynthesisUtterance = new SpeechSynthesisUtterance(speech);
            window.speechSynthesis.speak(speechSynthesisUtterance);
        }

        function toggleMenu() {
            var menuContainer = document.getElementById('menu-container');
            menuContainer.classList.toggle('open');
            var button = document.getElementById('menu-button');
            button.style.transform = menuContainer.classList.contains('open') ? 'rotate(180deg)' : 'rotate(0)';
        }

        function resetMap() {
            if (originMarker) {
                originMarker.setMap(null);
                originMarker = null;
            }
            if (destinationMarker) {
                destinationMarker.setMap(null);
                destinationMarker = null;
            }
            directionsDisplay.setDirections({routes: []});
            document.getElementById('origin').value = '';
            document.getElementById('destination').value = '';
            document.getElementById('route-details').style.display = 'none';
            stopSpeech();

            // Recenter the map to Thapar University Campus
            var thaparCenter = {lat: 30.35449823789197, lng: 76.36543075700676};
            map.setCenter(thaparCenter);
            map.setZoom(17);
        }

        function clearMarkers() {
            if (originMarker) {
                originMarker.setMap(null);
                originMarker = null;
            }
            if (destinationMarker) {
                destinationMarker.setMap(null);
                destinationMarker = null;
            }
            directionsDisplay.setDirections({routes: []});
            document.getElementById('route-details').style.display = 'none';
            stopSpeech();
        }

        function stopSpeech() {
            if (speechSynthesisUtterance) {
                window.speechSynthesis.cancel();
            }
        }

        function enableGPS() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    var pos = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    if (originMarker) {
                        originMarker.setPosition(pos);
                    } else {
                        setMarker(pos, 'Current Location', true);
                    }
                    map.setCenter(pos);
                    if (destinationMarker) {
                        calculateAndDisplayRoute();
                    }
                }, function() {
                    handleLocationError(true);
                });
            } else {
                handleLocationError(false);
            }
        }

        function handleLocationError(browserHasGeolocation) {
            var infoWindow = new google.maps.InfoWindow();
            infoWindow.setPosition(map.getCenter());
            infoWindow.setContent(browserHasGeolocation ?
                'Error: The Geolocation service failed.' :
                'Error: Your browser doesn\'t support geolocation.');
            infoWindow.open(map);
        }
    </script>
</head>
<body>
    <button id="menu-button" onclick="toggleMenu()">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M2 6h20M2 12h20M2 18h20"/>
        </svg>
    </button>
    <div id="menu-container">
        <div id="directions-form">
            <label for="origin">Origin</label>
            <input type="text" id="origin" placeholder="Enter origin address">
            <label for="destination">Destination</label>
            <input type="text" id="destination" placeholder="Enter destination address">
            <label for="travel-mode">Travel Mode</label>
            <select id="travel-mode">
                <option value="DRIVING">ðŸš— Driving</option>
                <option value="WALKING">ðŸš¶ Walking</option>
                <option value="BICYCLING">ðŸš´ Bicycling</option>
                <option value="TRANSIT">ðŸšŒ Transit</option>
            </select>
            <button onclick="calculateAndDisplayRoute()">Get Directions</button>
            <button onclick="clearMarkers()">Clear Markers</button>
            <button onclick="enableGPS()">Enable GPS</button>
        </div>
        <div id="route-details"></div>
    </div>
    <div id="map"></div>
    <button id="reset-button" onclick="resetMap()">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 4v8l6 4M12 20v-8l-6-4"/>
        </svg>
    </button>
</body>
</html>